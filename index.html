<!DOCTYPE html>
<meta charset="utf-8">
<style>

    body {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        margin: auto;
        position: relative;
        width: 960px;
    }

    text {
        font: 10px sans-serif;
    }

    form {
        position: absolute;
        right: 10px;
        top: 10px;
    }

</style>
<form>
    <input type="button" name="dataset" value="add">
    <input type="button" name="dataset" value="subtract">
</form>
<script src="//d3js.org/d3.v3.min.js"></script>
<script>
    var amount = 2;

    var arcCurrent;
    var phantomCurrent;

    var width = 350,
        height = 350,
        radius = Math.min(width, height) / 2;

    var center = width / 2;

    var pie = d3.layout.pie()
        .padAngle(-0.0005)
        .value(function(d) { return d[amount]; })
        .sort(null);

    var arc = d3.svg.arc()
        .innerRadius(radius - 30)
        .outerRadius(radius - 10)
        .startAngle((d) => d.startAngle + 0.05)
        .endAngle((d) => d.endAngle + 0.05);

    var svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height);

    d3.json("data2.json", function(error, data) {
        if (error) throw error;

        var path = svg.datum(data).selectAll("g.arc")
            .data(pie)
            .enter()
            .append("g")
            .attr("class", "arc")
            .attr("transform", "rotate(" + 5 + ")")
            .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")")
            .append("path")
            .attr("fill", function(d, i) {
                if (i % 2 === 0) {
                    return "#FDB81B";
                }
                return "white";
            })
            .attr("d", arc)
            .each(function(d) { this._current = d; }); // store the initial angles

        d3.selectAll("input")
            .on("click", change);

        function change() {
            var value = this.value;
            if (value === "add") {
                amount++;
                if (amount > 8) {
                    amount = 0;
                }
            }
            if (value === "subtract") {
                amount--;
                if (amount < 0) {
                    amount = 8;
                }
            }
            pie.value(function(d, i) {
                if (amount === 0) {
                    return d[1];
                }
                return d[amount];
            }); // change the value function
            path = path.data(pie);
            path.transition().duration(750).attrTween("d", arcTween);
        }
    });

    var circle = svg
                .append("circle")
                .attr("cx", 175)
                .attr("cy", 175)
                .attr("r", 150)
                .style("fill", "#607392");


    function type(d) {
        d.checked = amount;
        return d;
    }

    // Store the displayed angles in _current.
    // Then, interpolate from _current to the new angles.
    // During the transition, _current is updated in-place by d3.interpolate.
    function arcTween(a) {
        var i = d3.interpolate(this._current, a);
        this._current = i(0);
        return function(t) {
            return arc(i(t));
        };
    }
</script>
